<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.tailwindcss.com/3.4.1"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <title>Return Device</title>
</head>
<body class="bg-gray-50 p-6 min-h-screen font-sans">
    
    <div class="max-w-4xl w-full mx-auto">
        <div class="bg-white p-8 rounded-xl shadow-2xl">
            <h1 class="text-4xl font-extrabold text-gray-900 mb-6 border-b pb-4 text-center">Return a Device</h1>

            <!-- Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="mb-6 p-4 border-l-4 rounded-lg 
                            {% if category == 'success' %} bg-green-100 border-green-500 text-green-700
                            {% elif category == 'error' %} bg-red-100 border-red-500 text-red-700
                            {% else %} bg-blue-100 border-blue-500 text-blue-700
                            {% endif %}">
                            <p>{{ message }}</p>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <!-- Filter Buttons Section -->
            <div class="flex flex-wrap justify-center gap-3 mb-8">
                <a href="{{ url_for('return_device') }}">
                    <button class="btn filter-btn {% if not active_category %}active{% endif %}">All Devices</button>
                </a>
                {% for category in categories %}
                <a href="{{ url_for('return_device', category=category) }}">
                    <button class="btn filter-btn {% if active_category == category %}active{% endif %}">{{ category }}</button>
                </a>
                {% endfor %}
            </div>

            <!-- Loan Cards Container -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {% if active_loans %}
                    {% for loan_id, rubric_id, suffix_id, name, surname, category in active_loans %}
                    <div class="p-6 bg-yellow-50 border border-yellow-200 rounded-xl shadow-lg flex flex-col justify-between">
                        <div>
                            <p class="text-sm text-gray-500">{{ category }}</p>
                            <h3 class="text-xl font-bold text-gray-800 mb-4">{{ rubric_id }}-{{ suffix_id }}</h3>
                            <p class="text-sm text-gray-500">Loaned to</p>
                            <p class="text-lg font-semibold text-gray-700">{{ name }} {{ surname }}</p>
                        </div>
                        <form method="post" class="mt-6" onsubmit="return confirm('Are you sure you want to return this device? This action cannot be undone.');">
                            <input type="hidden" name="loan_id" value="{{ loan_id }}">
                            {% if active_category %}
                            <input type="hidden" name="category_filter" value="{{ active_category }}">
                            {% endif %}
                            <button class="btn red w-full" type="submit">Complete Return</button>
                        </form>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="md:col-span-2 lg:col-span-3 text-center py-12">
                        {% if active_category %}
                             <p class="text-xl text-gray-500">No '{{ active_category }}' devices are currently on loan.</p>
                        {% else %}
                             <p class="text-xl text-gray-500">There are no devices currently on loan.</p>
                        {% endif %}
                    </div>
                {% endif %}
            </div>

            <a href="{{ url_for('index') }}" class="mt-8 inline-block w-full">
                <button class="btn blue w-full">Back to Home</button>
            </a>
        </div>
    </div>

</body>
</html>

