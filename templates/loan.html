<!DOCTYPE html>
<html>
<head>
    <!-- Use Tailwind CSS for better styling and responsive design -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Custom styles for buttons and flash messages -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="{{ url_for('static', filename='loan.js') }}"></script>
    <title>Loan a Device</title>
    <style>
        /* Custom styling for the clickable rows */
        #device_table_body tr {
            cursor: pointer;
            transition: all 0.15s ease-in-out;
        }
        #device_table_body tr:hover {
            background-color: #f0f4ff; /* Light blue on hover */
        }
        /* Custom styling for the selected row (managed by JS) */
        .selected-row {
            background-color: #ffeccf !important; /* Light orange for selected */
            border-left: 5px solid #ff9800;
        }
    </style>
</head>
<body class="bg-gray-50 p-6 min-h-screen font-sans">
    <div class="max-w-5xl mx-auto bg-white p-8 rounded-xl shadow-2xl">
        <h1 class="text-4xl font-extrabold text-gray-900 mb-6 border-b pb-4 text-center">Loan a Device</h1>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="mb-4 p-4 border-l-4 rounded-lg 
                        {% if category == 'success' %} bg-green-100 border-green-500 text-green-700
                        {% elif category == 'error' or category == 'warning' %} bg-red-100 border-red-500 text-red-700
                        {% else %} bg-blue-100 border-blue-500 text-blue-700
                        {% endif %}">
                        <p>{{ message }}</p>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <form method="post" class="space-y-6">
            <h2 class="text-2xl font-semibold text-gray-800 mt-8 mb-4">1. Student Details</h2>
            
            <!-- Student Details: First/Last Name (2-col) and Email (Full Width) -->
            <div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input name="name" placeholder="First Name" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    <input name="surname" placeholder="Surname" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                </div>
                <input name="email" type="email" placeholder="Email Address" required class="w-full p-3 mt-4 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
            </div>

            <h2 class="text-2xl font-semibold text-gray-800 pt-6 border-t mt-8">2. Select Device</h2>
            
            <!-- Filter Buttons replacing Dropdown -->
            <div class="flex flex-col gap-3">
                <label class="block text-sm font-medium text-gray-700">Filter by Category:</label>
                <div id="category_filter_buttons" class="flex flex-wrap gap-2">
                    <button type="button" class="category-filter-btn px-4 py-2 text-sm font-medium rounded-full bg-blue-600 text-white shadow-md transition-all duration-200" data-filter="All">All Devices</button>
                    {% for category in categories %}
                        <button type="button" class="category-filter-btn px-4 py-2 text-sm font-medium rounded-full bg-gray-200 text-gray-700 hover:bg-blue-100 transition-all duration-200" data-filter="{{ category }}">{{ category }}</button>
                    {% endfor %}
                </div>
            </div>

            <!-- Filterable Device Table -->
            <div class="overflow-x-auto shadow-lg rounded-lg border border-gray-200">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-blue-500 text-white">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">ID</th>
                            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Rubric ID</th>
                            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Suffix ID</th>
                            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Category</th>
                        </tr>
                    </thead>
                    <tbody id="device_table_body" class="bg-white divide-y divide-gray-200">
                        {% for d in devices %}
                            <tr data-id="{{ d[0] }}" data-rubric="{{ d[1] }}" data-suffix="{{ d[2] }}" data-category="{{ d[3] }}">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ d[0] }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">{{ d[1] }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">{{ d[2] }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">{{ d[3] }}</span>
                                </td>
                            </tr>
                        {% endfor %}
                        {% if not devices %}
                            <tr><td colspan="4" class="py-10 text-center text-gray-500 italic">No devices are currently available for loan.</td></tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>

            <!-- Hidden Input for Selected Device ID -->
            <input type="hidden" name="selected_device_id" id="selected_device_id" value="">
            
            <p id="device_select_message" class="text-center font-semibold text-orange-600 p-3 bg-orange-50 rounded-lg border border-orange-200">
                Please click on a device row in the table above to select it.
            </p>

            <div class="flex justify-center pt-4 space-x-4">
                <button id="loan_device_button" class="btn blue w-full sm:w-64 shadow-lg hover:shadow-xl" type="submit" disabled>
                    Loan Device
                </button>
                <a href="{{ url_for('index') }}">
                    <button type="button" class="btn green w-full sm:w-64 shadow-lg hover:shadow-xl">Back to Home</button>
                </a>
            </div>
        </form>
    </div>
</body>
</html>
