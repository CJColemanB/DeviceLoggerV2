<!DOCTYPE html>
<html>
<head>
    <!-- Load Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="{{ url_for('static', filename='loan.js') }}" defer></script>
    <title>Loan Device</title>
</head>
<body class="bg-gray-50 p-6 min-h-screen font-sans">
    <div class="max-w-6xl mx-auto bg-white p-8 rounded-xl shadow-2xl">
        <h1 class="text-4xl font-extrabold text-gray-900 mb-6 border-b pb-4 text-center">Loan a Device</h1>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="mb-4 p-4 border-l-4 rounded-lg 
                        {% if category == 'success' %} bg-green-100 border-green-500 text-green-700
                        {% elif category == 'error' %} bg-red-100 border-red-500 text-red-700
                        {% else %} bg-blue-100 border-blue-500 text-blue-700
                        {% endif %}">
                        <p>{{ message }}</p>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <form method="post" class="space-y-6" id="loan-form">
            <h2 class="text-2xl font-semibold text-gray-800">Student Information</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- First Name -->
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
                    <input name="name" id="name" placeholder="First Name" required class="input-field w-full">
                </div>
                <!-- Surname -->
                <div>
                    <label for="surname" class="block text-sm font-medium text-gray-700 mb-1">Surname</label>
                    <input name="surname" id="surname" placeholder="Surname" required class="input-field w-full">
                </div>
            </div>
            
            <!-- Email (Moved underneath) -->
            <div>
                <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                <input name="email" id="email" type="email" placeholder="Student Email" required class="input-field w-full">
            </div>

            <h2 class="text-2xl font-semibold text-gray-800 pt-4">Select Device</h2>
            
            <!-- Filter Buttons -->
            <div class="flex flex-wrap gap-3 mb-4" id="category-filters">
                <button type="button" class="filter-btn btn blue" data-category="All">Show All ({{ devices | length }})</button>
                {% for category in categories %}
                    <button type="button" class="filter-btn btn blue" data-category="{{ category }}">{{ category }}</button>
                {% endfor %}
            </div>

            <!-- Available Devices Table -->
            <div class="overflow-x-auto shadow-md rounded-lg">
                <table id="devices-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Rubric</th>
                            <th>Suffix</th>
                            <th>Category</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for d in devices %}
                        <tr class="device-row hover:bg-indigo-50 cursor-pointer" 
                            data-device-id="{{ d[0] }}" 
                            data-category="{{ d[3] }}">
                            <td class="font-bold">{{ d[0] }}</td>
                            <td>{{ d[1] }}</td>
                            <td>{{ d[2] }}</td>
                            <td>{{ d[3] }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <!-- Hidden Input for Selected Device ID -->
            <input type="hidden" name="selected_device_id" id="selected_device_id" required>

            <button class="btn green w-full mt-6" type="submit" id="loan-button" disabled>Loan Selected Device</button>
        </form>

        <a href="{{ url_for('index') }}" class="mt-6 inline-block">
            <button class="btn blue">Back to Home</button>
        </a>
    </div>
</body>
</html>
